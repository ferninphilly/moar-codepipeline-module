version: 0.2

env:
  shell: bash
  secrets-manager:
    NPM_AUTH_TOKEN: "npmjs/publish/authToken"
phases:
  pre_build:
    commands:
      - echo "//registry.npmjs.org/:_authToken=$NPM_AUTH_TOKEN" > ./.npmrc
      - yarn version patch --new-version patch
  build:
    commands:
      - rm -rf node_modules
      - yarn install --frozen-lockfile
      - yarn publish --non-interactive --patch --no-git-tag-version
  post_build:
    commands:
      - rm -rf node_modules
      - git add .
      - git commit -m "Updated version from codepipeline"
      - git push origin ${ENVIRONMENT}